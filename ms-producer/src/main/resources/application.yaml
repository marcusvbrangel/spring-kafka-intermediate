
server:
  port: ${SERVER_PORT:5050}

spring:
  application:
    name: ms-producer

  # =============================================================================================
  # POSTGRES CONFIGURATION
  # =============================================================================================
  datasource:
    hikari:
      connection-timeout: ${DATASOURCE_CONNECTION_TIMEOUT:20000}
      maximum-pool-size: ${DATASOURCE_MAX_POOL_SIZE:5}

    url: ${DATASOURCE_URL:jdbc:postgresql://localhost:5432/ms-producer}
    username: ${DATASOURCE_USERNAME:postgres}
    password: ${DATASOURCE_PASSWORD:postgres}

  jpa:
    show-sql: ${SHOW_SQL:false}
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        format_sql: ${FORMAT_SQL:true}

  # =============================================================================================
  # FLYWAY CONFIGURATION
  # =============================================================================================
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration


  # =============================================================================================
  # KAFKA CONFIGURATION
  # =============================================================================================
  kafka:
    #bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092,localhost:9093,localhost:9094}

    # Producer configurations
    producer:
      # Critical producer settings (high durability)
      critical:
        acks: all
        enable-idempotence: true
        retries: 2147483647  # Integer.MAX_VALUE
        delivery-timeout-ms: 120000
        request-timeout-ms: 30000
        max-in-flight-requests-per-connection: 5
        compression-type: snappy
        linger-ms: 10
        batch-size: 16384

      # Default producer settings (balanced)
      default:
        acks: 1
        compression-type: lz4

      # Fast producer settings (fire-and-forget)
      fast:
        acks: 0
        linger-ms: 50
        batch-size: 32768

    # Topics
    topics:
      payment-approved: ${KAFKA_TOPIC_PAYMENT_APPROVED:payment.approved.v1}

# ===============================================================================================
# OUTBOX PATTERN CONFIGURATION
# ===============================================================================================
outbox:
  publisher:
    # Frequência de execução do job (milissegundos)
    # Default: a cada 5 segundos
    fixed-delay: ${OUTBOX_PUBLISHER_FIXED_DELAY:5000}

    # Número máximo de eventos a processar por batch
    # Default: 100 eventos
    # Ajustar conforme throughput necessário
    batch-size: ${OUTBOX_PUBLISHER_BATCH_SIZE:100}

    # Número máximo de tentativas antes de marcar como FAILED
    # Default: 3 tentativas
    max-retries: ${OUTBOX_PUBLISHER_MAX_RETRIES:3}

# ===============================================================================================
# SPRING TASK SCHEDULING (required for @Scheduled)
# ===============================================================================================
spring.task:
  scheduling:
    pool:
      size: 2  # Número de threads para scheduled tasks


# ===============================================================================================
# OPEN TELEMETRY
# ===============================================================================================
otel:
  sdk:
    disabled: false
  service:
    name: ms-producer
  traces:
    exporter: otlp
    sampler: always_on
  metrics:
    exporter: otlp
  logs:
    exporter: otlp
  exporter:
    otlp:
      protocol: grpc
      endpoint: http://localhost:4317
  metric:
    export:
      interval: 5000
  resource:
    attributes:
      service.version: 0.0.1
      deployment.environment: development

